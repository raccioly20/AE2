{
  "hash": "d40f6eaf9c49565e562dea5867d7b3ce",
  "result": {
    "markdown": "---\ntitle: \"Avaliando Series Temporais\"\nauthor: \"Ricardo Accioly\"\ndate: \"2022-10-20\"\noutput:\n html_document:\n    toc: yes\n    code_download: yes\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n# parametros para imagens\nknitr::opts_chunk$set(\n  fig.width = 8,\n  fig.asp = 0.618,\n  fig.retina = 3,\n  dpi = 300,\n  out.width = \"80%\"\n)\n```\n:::\n\n\n## Séries Temporais\n\nNestes exemplos vamos usar algumas bibliotecas do R que são usadas na análise de séries temporais financeiras e também na sua modelagem.\n\n## Obtendo e Visualizando uma ST\n\nVamos inicialmente usando a biblioteca (pacote) quantmod fazer um download dos preços da Petrobras (PETR4) entre 2000 e 2022.\n\nA biblioteca quantmod depende dos pacotes xts e do zoo que são dois pacotes usados para manipular dados de series temporais.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(quantmod)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nCarregando pacotes exigidos: xts\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCarregando pacotes exigidos: zoo\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'zoo'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    as.Date, as.Date.numeric\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCarregando pacotes exigidos: TTR\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nRegistered S3 method overwritten by 'quantmod':\n  method            from\n  as.zoo.data.frame zoo \n```\n:::\n\n```{.r .cell-code}\ngetSymbols(\"PETR4.SA\",from=\"2000-01-01\", to=\"2022-09-30\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: PETR4.SA contains missing values. Some functions will not work if\nobjects contain missing values in the middle of the series. Consider using\nna.omit(), na.approx(), na.fill(), etc to remove or replace them.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"PETR4.SA\"\n```\n:::\n\n```{.r .cell-code}\nhead(PETR4.SA)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           PETR4.SA.Open PETR4.SA.High PETR4.SA.Low PETR4.SA.Close\n2000-01-03         5.875         5.875        5.875          5.875\n2000-01-04         5.550         5.550        5.550          5.550\n2000-01-05         5.494         5.494        5.494          5.494\n2000-01-06         5.475         5.475        5.475          5.475\n2000-01-07         5.500         5.500        5.500          5.500\n2000-01-10         5.613         5.613        5.613          5.613\n           PETR4.SA.Volume PETR4.SA.Adjusted\n2000-01-03     35389440000          2.139588\n2000-01-04     28861440000          2.021228\n2000-01-05     43033600000          2.000833\n2000-01-06     34055680000          1.993914\n2000-01-07     20912640000          2.003018\n2000-01-10     19563520000          2.044172\n```\n:::\n\n```{.r .cell-code}\n# A biblioteca tem uma forma diferenciada de apresentação das series financeiras\nchartSeries(PETR4.SA,theme=\"white\")\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-2-1.png){width=80%}\n:::\n:::\n\n\nVeja que os dados recebidos tem valores de abertura (open), alta (high), baixa (low) e fechamento (close)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(PETR4.SA)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     Index            PETR4.SA.Open   PETR4.SA.High    PETR4.SA.Low   \n Min.   :2000-01-03   Min.   : 4.20   Min.   : 4.27   Min.   : 4.120  \n 1st Qu.:2005-07-04   1st Qu.:10.15   1st Qu.:10.35   1st Qu.: 9.969  \n Median :2011-03-28   Median :19.09   Median :19.39   Median :18.765  \n Mean   :2011-04-09   Mean   :18.92   Mean   :19.20   Mean   :18.617  \n 3rd Qu.:2017-01-03   3rd Qu.:26.05   3rd Qu.:26.43   3rd Qu.:25.650  \n Max.   :2022-09-29   Max.   :67.50   Max.   :67.50   Max.   :51.950  \n                      NA's   :1       NA's   :1       NA's   :1       \n PETR4.SA.Close  PETR4.SA.Volume     PETR4.SA.Adjusted\n Min.   : 4.20   Min.   :0.000e+00   Min.   : 1.593   \n 1st Qu.:10.11   1st Qu.:2.113e+07   1st Qu.: 4.263   \n Median :19.10   Median :3.374e+07   Median : 8.625   \n Mean   :18.89   Mean   :5.644e+08   Mean   : 8.904   \n 3rd Qu.:26.00   3rd Qu.:5.434e+07   3rd Qu.:12.128   \n Max.   :52.51   Max.   :7.356e+10   Max.   :34.480   \n NA's   :1       NA's   :1           NA's   :1        \n```\n:::\n:::\n\n\n## Vamos selecionar somente o fechamento (close)\n\nPara trabalhar com somente uma das series vamos selecionar sua coluna de dados\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPETR4.SA.Close <- PETR4.SA[,\"PETR4.SA.Close\"]\nchartSeries(PETR4.SA.Close,theme=\"white\")\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-4-1.png){width=80%}\n:::\n:::\n\n\n## Podemos extrair somente um ano?\n\nVamos usar os dados de 2000.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPETR4_2000 <- PETR4.SA.Close[\"2000\"]\nchartSeries(PETR4_2000,theme=\"white\")\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-5-1.png){width=80%}\n:::\n:::\n\n\n## Podemos extrair um intervalo?\n\nVamos usar os dados de 2000 a 2001.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPETR4_2000_2001 <- PETR4.SA.Close[\"2000/2001\"] \nchartSeries(PETR4_2000_2001,theme=\"white\")\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-6-1.png){width=80%}\n:::\n:::\n\n\n## Vamos trabalhar com outro intervalo\n\nVamos usar dados de set/21 a set/22.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPETR4.SA.Close <- PETR4.SA.Close[\"2021-09-01/2022-09-30\"]\nchartSeries(PETR4.SA.Close,theme=\"white\")\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-7-1.png){width=80%}\n:::\n:::\n\n\n## Visualizando o início e o fim da serie\n\nAqui vamos usar funções da xts visualizar diferentes periodos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfirst(PETR4.SA.Close, \"month\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           PETR4.SA.Close\n2021-09-01          27.04\n2021-09-02          26.60\n2021-09-03          26.33\n2021-09-06          26.46\n2021-09-08          24.97\n2021-09-09          25.50\n2021-09-10          25.34\n2021-09-13          26.23\n2021-09-14          25.88\n2021-09-15          26.33\n2021-09-16          26.10\n2021-09-17          24.93\n2021-09-20          24.65\n2021-09-21          25.21\n2021-09-22          25.85\n2021-09-23          26.84\n2021-09-24          26.90\n2021-09-27          27.14\n2021-09-28          26.96\n2021-09-29          27.39\n2021-09-30          27.23\n```\n:::\n\n```{.r .cell-code}\nlast(PETR4.SA.Close, \"6 weeks\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           PETR4.SA.Close\n2022-08-22          32.41\n2022-08-23          33.44\n2022-08-24          33.64\n2022-08-25          33.28\n2022-08-26          33.64\n2022-08-29          34.48\n2022-08-30          32.43\n2022-08-31          33.23\n2022-09-01          33.85\n2022-09-02          33.42\n2022-09-05          33.34\n2022-09-06          32.10\n2022-09-08          31.80\n2022-09-09          31.79\n2022-09-12          31.48\n2022-09-13          30.65\n2022-09-14          31.12\n2022-09-15          31.06\n2022-09-16          30.78\n2022-09-19          31.27\n2022-09-20          31.09\n2022-09-21          31.17\n2022-09-22          31.94\n2022-09-23          29.94\n2022-09-26          29.29\n2022-09-27          29.67\n2022-09-28          29.27\n2022-09-29          29.31\n```\n:::\n:::\n\n\n## Usando o pacote astsa\n\nVamos usar algumas funcionalidades do pacote astsa que permite visualizações e modelagem de series temporais.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(astsa)\nlag1.plot(PETR4.SA.Close,12, col=astsa.col(4, .3), pch=20, cex=2)\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-9-1.png){width=80%}\n:::\n:::\n\n\n## Esta série é um ruído branco?\n\nPrimeiro vamos ver graficamente o FAC/ACF e a FACP/PACF e depois vamos usar o teste de Box-Pierce e Ljung-Box.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nacf2(PETR4.SA.Close)\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-10-1.png){width=80%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n     [,1]  [,2] [,3] [,4]  [,5]  [,6] [,7]  [,8]  [,9] [,10] [,11] [,12] [,13]\nACF  0.95  0.90 0.86 0.82  0.78  0.73 0.69  0.65  0.60  0.56  0.52  0.49  0.45\nPACF 0.95 -0.01 0.05 0.00 -0.02 -0.03 0.00 -0.06 -0.08  0.01  0.05 -0.04  0.00\n     [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24] [,25]\nACF   0.41  0.39  0.37  0.35  0.33  0.31  0.30  0.29  0.27  0.25  0.24  0.22\nPACF -0.03  0.08  0.05  0.02 -0.04  0.03  0.07 -0.03 -0.09 -0.04  0.05 -0.07\n     [,26] [,27]\nACF   0.21  0.20\nPACF  0.11 -0.05\n```\n:::\n\n```{.r .cell-code}\nBox.test(PETR4.SA.Close, lag=20, type = \"Box-Pierce\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tBox-Pierce test\n\ndata:  PETR4.SA.Close\nX-squared = 2004.7, df = 20, p-value < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\nBox.test(PETR4.SA.Close, lag=20, type = \"Ljung-Box\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tBox-Ljung test\n\ndata:  PETR4.SA.Close\nX-squared = 2071.8, df = 20, p-value < 2.2e-16\n```\n:::\n:::\n\n\n## Vamos agora trabalhar com os log retornos das ações\n\nPara obter os log retornos vamos usar uma função da biblioteca qrmtools.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(qrmtools)\npetr4.logret <- returns(PETR4.SA.Close, method=\"logarithmic\")\nhead(petr4.logret)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                   [,1]\n2021-09-02 -0.016406072\n2021-09-03 -0.010202242\n2021-09-06  0.004925147\n2021-09-08 -0.057959057\n2021-09-09  0.021003388\n2021-09-10 -0.006294277\n```\n:::\n\n```{.r .cell-code}\nchartSeries(petr4.logret,theme=\"white\")\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-11-1.png){width=80%}\n:::\n:::\n\n\n## Esta série é um ruído branco?\n\nVamos usar o teste de Box-Pierce e Ljung-Box\n\n\n::: {.cell}\n\n```{.r .cell-code}\nacf2(petr4.logret)\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-12-1.png){width=80%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n      [,1]  [,2]  [,3]  [,4] [,5]  [,6] [,7] [,8]  [,9] [,10] [,11] [,12] [,13]\nACF  -0.03 -0.07 -0.02 -0.01 0.03 -0.04 0.04 0.07 -0.03 -0.08 -0.01 -0.03  0.02\nPACF -0.03 -0.08 -0.03 -0.02 0.02 -0.04 0.04 0.07 -0.02 -0.07 -0.01 -0.04  0.01\n     [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24] [,25]\nACF  -0.08 -0.06 -0.01  0.03 -0.05 -0.07  0.02  0.09  0.04 -0.07  0.05 -0.13\nPACF -0.09 -0.07 -0.03  0.02 -0.05 -0.07  0.00  0.08  0.05 -0.05  0.04 -0.15\n     [,26] [,27]\nACF   0.03 -0.10\nPACF  0.03 -0.12\n```\n:::\n\n```{.r .cell-code}\nBox.test(petr4.logret, lag=20, type = \"Box-Pierce\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tBox-Pierce test\n\ndata:  petr4.logret\nX-squared = 11.561, df = 20, p-value = 0.9304\n```\n:::\n\n```{.r .cell-code}\nBox.test(petr4.logret, lag=20, type = \"Ljung-Box\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tBox-Ljung test\n\ndata:  petr4.logret\nX-squared = 12.146, df = 20, p-value = 0.9109\n```\n:::\n:::\n\n\n## Vamos avaliar de outra forma\n\nNo teste anterior usamos somente o lag = 20 para testar a série. Vamos usar a biblioteca astsa que faz este teste para vários lags além de avaliar outras características da série.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsarima(petr4.logret,p=0,d=0,q=0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ninitial  value -3.635431 \niter   1 value -3.635431\nfinal  value -3.635431 \nconverged\ninitial  value -3.635431 \niter   1 value -3.635431\nfinal  value -3.635431 \nconverged\n```\n:::\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-13-1.png){width=80%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n$fit\n\nCall:\narima(x = xdata, order = c(p, d, q), seasonal = list(order = c(P, D, Q), period = S), \n    xreg = xmean, include.mean = FALSE, transform.pars = trans, fixed = fixed, \n    optim.control = list(trace = trc, REPORT = 1, reltol = tol))\n\nCoefficients:\n       xmean\n      0.0003\ns.e.  0.0016\n\nsigma^2 estimated as 0.0006955:  log likelihood = 596.24,  aic = -1188.47\n\n$degrees_of_freedom\n[1] 268\n\n$ttable\n      Estimate     SE t.value p.value\nxmean    3e-04 0.0016  0.1862  0.8524\n\n$AIC\n[1] -4.418115\n\n$AICc\n[1] -4.418059\n\n$BIC\n[1] -4.391389\n```\n:::\n:::\n\n\n## Podemos agragar valores diários de diversas formas\n\nPara agregar valores de series temporais vamos usar a biblioteca xts\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(xts)\npetr4.logret.sem <- apply.weekly(petr4.logret, sum)\nfirst(petr4.logret.sem, \"2 week\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                  [,1]\n2021-09-03 -0.02660831\n2021-09-10 -0.03832480\n```\n:::\n\n```{.r .cell-code}\npetr4.logret.men <- apply.monthly(petr4.logret, sum)\nfirst(petr4.logret.men, \"2 month\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                   [,1]\n2021-09-30  0.007002019\n2021-10-29 -0.002942260\n```\n:::\n:::\n\n\n## Os log retornos seguem uma distribuição normal?\n\nVamos usar alguma ferrametas gráficas para avaliar os dados de log-retorno\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmu <- mean(petr4.logret)\nsigma <- sd(petr4.logret)\nc(mu, sigma)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.0002996708 0.0264217221\n```\n:::\n\n```{.r .cell-code}\nx <- sort(coredata(petr4.logret))\nhist(x, breaks = \"Sturges\" , probability = TRUE)\nlines(x, dnorm(x, mean = mu, sd = sigma), col = \"red\")\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-15-1.png){width=80%}\n:::\n\n```{.r .cell-code}\nqqnorm(x)\nqqline(x)\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-15-2.png){width=80%}\n:::\n:::\n\n\n## Outra avaliação Jarque-Bera\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(moments)\nx <- sort(coredata(petr4.logret))\njarque.test(x)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tJarque-Bera Normality Test\n\ndata:  x\nJB = 367.04, p-value < 2.2e-16\nalternative hypothesis: greater\n```\n:::\n:::\n\n\n## E o log retorno semanal?\n\nVamos usar alguma ferrametas gráficas para avaliar os dados de log-retorno\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmu <- mean(petr4.logret.sem)\nsigma <- sd(petr4.logret.sem)\nc(mu, sigma)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.001414236 0.052515186\n```\n:::\n\n```{.r .cell-code}\nx <- sort(coredata(petr4.logret.sem))\nhist(x, breaks = \"Sturges\" , probability = TRUE)\nlines(x, dnorm(x, mean = mu, sd = sigma), col = \"red\")\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-17-1.png){width=80%}\n:::\n\n```{.r .cell-code}\nqqnorm(x)\nqqline(x)\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-17-2.png){width=80%}\n:::\n:::\n\n\n## Outra avaliação Jarque-Bera\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(moments)\nx <- sort(coredata(petr4.logret.sem))\njarque.test(x)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tJarque-Bera Normality Test\n\ndata:  x\nJB = 1.0108, p-value = 0.6033\nalternative hypothesis: greater\n```\n:::\n:::\n\n\n## Vamos simular um processo AR(1)\n\nVamos usar as funções da biblioteca astsa.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(2,1))                         \n# na expressão abaixo ~ é igual a um espaço e == é o igual\ntsplot(sarima.sim(ar= .9, n=100), col=4, ylab=\"\", main=(expression(AR(1)~~~phi==+.9))) \ntsplot(sarima.sim(ar=-.9, n=100), col=4, ylab=\"\", main=(expression(AR(1)~~~phi==-.9))) \n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-19-1.png){width=80%}\n:::\n:::\n\n\n## Vamos simular um processo MA(1)\n\nVamos usar as funções da biblioteca astsa.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(2,1))                                   \ntsplot(sarima.sim(ma= .9, n=100), col=4, ylab=\"\", main=(expression(MA(1)~~~theta==+.9)))    \ntsplot(sarima.sim(ma=-.9, n=100), col=4, ylab=\"\", main=(expression(MA(1)~~~theta==-.9)))    \n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-20-1.png){width=80%}\n:::\n:::\n\n\n## Vamos simular um AR(2)\n\nVamos usar outra função básica do R para simular um AR(2) para fazer a representação gráfica de um AR(2) através dos seus ACF e PACF.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nacf <- ARMAacf(ar=c(1.5,-.75), ma=0, 24)\npacf <- ARMAacf(ar=c(1.5,-.75), ma=0, 24, pacf=T)\npar(mfrow=c(1,2))\nplot(acf, type=\"h\", xlab=\"lag\")\nabline(h=0)\nplot(pacf, type=\"h\", xlab=\"lag\")\nabline(h=0)\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-21-1.png){width=80%}\n:::\n:::\n\n\n## Vamos analisar dados de Recrutamento\n\nRecrutamento (índice do número de novos peixes) por um período de 453 meses que se passaram ao longo dos anos 1950-1987. O recrutamento é vagamente definido como um indicador de novos membros de uma população para a primeira fase de vida em que a mortalidade natural se estabiliza perto dos níveis adultos.\n\nEstes dados estão na biblioteca astsa.\n\nVamos usar uma parte para ajustar o modelo e depois vamos ver como ficam as previsões com relação aos resultados reais.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# library(astsa)\ndata(rec)\nrecr <- window(rec, start=c(1950,1), end=c(1985,9))\npar(mfrow=c(2,1))\nacf(recr, 24)\npacf(recr, 24)\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-22-1.png){width=80%}\n:::\n\n```{.r .cell-code}\nacf2(recr)\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-22-2.png){width=80%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n     [,1]  [,2]  [,3]  [,4] [,5]  [,6]  [,7] [,8] [,9] [,10] [,11] [,12] [,13]\nACF  0.92  0.79  0.64  0.49 0.37  0.27  0.19 0.13 0.09  0.06  0.04  0.00 -0.07\nPACF 0.92 -0.45 -0.04 -0.02 0.08 -0.05 -0.05 0.04 0.05 -0.03 -0.06 -0.15 -0.15\n     [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24] [,25]\nACF  -0.14 -0.21 -0.26 -0.29 -0.28 -0.25 -0.20 -0.12 -0.04  0.02  0.05  0.04\nPACF -0.02  0.02 -0.01  0.03  0.04  0.09  0.09  0.03 -0.02 -0.04 -0.05 -0.13\n     [,26] [,27] [,28] [,29] [,30] [,31] [,32] [,33] [,34] [,35] [,36] [,37]\nACF   0.01 -0.02 -0.06 -0.09 -0.11 -0.12 -0.10 -0.06  0.01  0.07  0.09  0.08\nPACF -0.03  0.06 -0.09 -0.05 -0.02  0.06  0.03  0.13  0.08 -0.02 -0.10 -0.07\n     [,38] [,39] [,40] [,41] [,42] [,43] [,44] [,45] [,46] [,47] [,48]\nACF   0.04  0.00 -0.02 -0.03 -0.03 -0.02  0.00  0.04  0.09  0.14  0.17\nPACF  0.03  0.02  0.07 -0.04 -0.02 -0.04  0.05  0.01  0.04  0.10 -0.04\n```\n:::\n:::\n\n\n## Que tal um AR(2)\n\nAqui usando comandos básicos do R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- 2\nd <- 0\nq <- 0\nmod1 <- arima(recr,order=c(p,d,q),method=\"ML\")\ntsdiag(mod1)\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-23-1.png){width=80%}\n:::\n:::\n\n\n## Previsões a partir do modelo ajustado\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrec.pr <- predict(mod1, n.ahead=24)\ninf <- rec.pr$pred + rec.pr$se\nsup <- rec.pr$pred - rec.pr$se\ntsplot(recr, type=\"o\", ylab=\"recrutamento\", xlim=c(1980,1988))\nlines(rec.pr$pred, col=\"red\", type=\"o\")\nlines(inf, col=\"blue\", lty=\"dashed\")\nlines(sup, col=\"blue\", lty=\"dashed\")\nlines(rec)\nabline(h=coef(mod1)[names(coef(mod1))=='intercept'])\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-24-1.png){width=80%}\n:::\n:::\n\n\n## Usando a biblioteca ASTSA\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- 2\nd <- 0\nq <- 0\nsarima(recr,p=p,d=d,q=q, gg=TRUE, col=4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ninitial  value 3.335343 \niter   2 value 3.264072\niter   3 value 2.562334\niter   4 value 2.425870\niter   5 value 2.258615\niter   6 value 2.254532\niter   7 value 2.253817\niter   8 value 2.253804\niter   9 value 2.253802\niter  10 value 2.253799\niter  11 value 2.253799\niter  12 value 2.253799\niter  13 value 2.253798\niter  14 value 2.253797\niter  15 value 2.253797\niter  15 value 2.253797\nfinal  value 2.253797 \nconverged\ninitial  value 2.254327 \niter   2 value 2.254322\niter   3 value 2.254320\niter   4 value 2.254319\niter   5 value 2.254319\niter   6 value 2.254319\niter   7 value 2.254319\niter   8 value 2.254318\niter   9 value 2.254318\niter   9 value 2.254318\niter   9 value 2.254318\nfinal  value 2.254318 \nconverged\n```\n:::\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-25-1.png){width=80%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n$fit\n\nCall:\narima(x = xdata, order = c(p, d, q), seasonal = list(order = c(P, D, Q), period = S), \n    xreg = xmean, include.mean = FALSE, transform.pars = trans, fixed = fixed, \n    optim.control = list(trace = trc, REPORT = 1, reltol = tol))\n\nCoefficients:\n         ar1      ar2    xmean\n      1.3418  -0.4516  61.9062\ns.e.  0.0429   0.0429   4.1418\n\nsigma^2 estimated as 90.29:  log likelihood = -1575.83,  aic = 3159.65\n\n$degrees_of_freedom\n[1] 426\n\n$ttable\n      Estimate     SE  t.value p.value\nar1     1.3418 0.0429  31.2549       0\nar2    -0.4516 0.0429 -10.5159       0\nxmean  61.9062 4.1418  14.9468       0\n\n$AIC\n[1] 7.365161\n\n$AICc\n[1] 7.365293\n\n$BIC\n[1] 7.40303\n```\n:::\n\n```{.r .cell-code}\nsarima.for(recr, n.ahead=24, p=2, d=0, q=0, plot=TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$pred\n          Jan      Feb      Mar      Apr      May      Jun      Jul      Aug\n1985                                                                        \n1986 75.20659 72.25139 69.78139 67.80161 66.26051 65.08665 64.20747 63.55787\n1987 62.19281 62.10513 62.04370 62.00087 61.97114 61.95058 61.93643 61.92672\n          Sep      Oct      Nov      Dec\n1985          84.27178 81.81321 78.51797\n1986 63.08323 62.73971 62.49309 62.31731\n1987 61.92009                           \n\n$se\n           Jan       Feb       Mar       Apr       May       Jun       Jul\n1985                                                                      \n1986 23.410705 25.288870 26.425340 27.090863 27.469631 27.679844 27.793943\n1987 27.917314 27.918328 27.918821 27.919058 27.919172 27.919226 27.919251\n           Aug       Sep       Oct       Nov       Dec\n1985                      9.502359 15.901825 20.424515\n1986 27.854666 27.886424 27.902778 27.911083 27.915248\n1987 27.919263 27.919268                              \n```\n:::\n\n```{.r .cell-code}\nlines(rec)\n```\n\n::: {.cell-output-display}\n![](Aula06_files/figure-html/unnamed-chunk-25-2.png){width=80%}\n:::\n:::\n",
    "supporting": [
      "Aula06_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}