{
  "hash": "b212a5b62edaeec53263998ab8ba8005",
  "result": {
    "markdown": "---\ntitle: \"Avaliando Series Temporais\"\nauthor: \"Ricardo Accioly\"\ndate: \"2023-06-07\"\nformat:\n html:\n    code-link: true\n---\n\n\n\n\n## Séries Temporais\n\nNestes exemplos vamos usar algumas bibliotecas do R que são usadas na análise de séries temporais financeiras e também na sua modelagem.\n\n## Obtendo e Visualizando uma ST\n\nVamos inicialmente usando a biblioteca (pacote) quantmod fazer um download dos preços da Petrobras (PETR4) entre 2000 e 2022.\n\nA biblioteca quantmod depende dos pacotes xts e do zoo que são dois pacotes usados para manipular dados de series temporais.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(quantmod)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nCarregando pacotes exigidos: xts\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCarregando pacotes exigidos: zoo\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'zoo'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    as.Date, as.Date.numeric\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCarregando pacotes exigidos: TTR\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nRegistered S3 method overwritten by 'quantmod':\n  method            from\n  as.zoo.data.frame zoo \n```\n:::\n\n```{.r .cell-code}\ngetSymbols(\"PETR4.SA\",from=\"2000-01-01\", to=\"2022-09-30\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: PETR4.SA contains missing values. Some functions will not work if\nobjects contain missing values in the middle of the series. Consider using\nna.omit(), na.approx(), na.fill(), etc to remove or replace them.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"PETR4.SA\"\n```\n:::\n\n```{.r .cell-code}\nhead(PETR4.SA)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           PETR4.SA.Open PETR4.SA.High PETR4.SA.Low PETR4.SA.Close\n2000-01-03         5.875         5.875        5.875          5.875\n2000-01-04         5.550         5.550        5.550          5.550\n2000-01-05         5.494         5.494        5.494          5.494\n2000-01-06         5.475         5.475        5.475          5.475\n2000-01-07         5.500         5.500        5.500          5.500\n2000-01-10         5.613         5.613        5.613          5.613\n           PETR4.SA.Volume PETR4.SA.Adjusted\n2000-01-03     35389440000          1.666141\n2000-01-04     28861440000          1.573971\n2000-01-05     43033600000          1.558090\n2000-01-06     34055680000          1.552701\n2000-01-07     20912640000          1.559791\n2000-01-10     19563520000          1.591838\n```\n:::\n\n```{.r .cell-code}\n# A biblioteca tem uma forma diferenciada de apresentação das series financeiras\nchartSeries(PETR4.SA,theme=\"white\")\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-2-1.png){width=80%}\n:::\n:::\n\n\nVeja que os dados recebidos tem valores de abertura (open), alta (high), baixa (low) e fechamento (close)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(PETR4.SA)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     Index            PETR4.SA.Open   PETR4.SA.High    PETR4.SA.Low   \n Min.   :2000-01-03   Min.   : 4.20   Min.   : 4.27   Min.   : 4.120  \n 1st Qu.:2005-07-04   1st Qu.:10.15   1st Qu.:10.35   1st Qu.: 9.969  \n Median :2011-03-28   Median :19.09   Median :19.39   Median :18.765  \n Mean   :2011-04-09   Mean   :18.92   Mean   :19.20   Mean   :18.617  \n 3rd Qu.:2017-01-03   3rd Qu.:26.05   3rd Qu.:26.43   3rd Qu.:25.650  \n Max.   :2022-09-29   Max.   :67.50   Max.   :67.50   Max.   :51.950  \n                      NA's   :1       NA's   :1       NA's   :1       \n PETR4.SA.Close  PETR4.SA.Volume     PETR4.SA.Adjusted\n Min.   : 4.20   Min.   :0.000e+00   Min.   : 1.241   \n 1st Qu.:10.11   1st Qu.:2.113e+07   1st Qu.: 3.320   \n Median :19.10   Median :3.374e+07   Median : 6.716   \n Mean   :18.89   Mean   :5.644e+08   Mean   : 6.934   \n 3rd Qu.:26.00   3rd Qu.:5.434e+07   3rd Qu.: 9.445   \n Max.   :52.51   Max.   :7.356e+10   Max.   :26.850   \n NA's   :1       NA's   :1           NA's   :1        \n```\n:::\n:::\n\n\n## Vamos selecionar somente o fechamento (close)\n\nPara trabalhar com somente uma das series vamos selecionar sua coluna de dados\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPETR4.SA.Close <- PETR4.SA[,\"PETR4.SA.Close\"]\nchartSeries(PETR4.SA.Close,theme=\"white\")\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-4-1.png){width=80%}\n:::\n:::\n\n\n## Podemos extrair somente um ano?\n\nVamos usar os dados de 2000.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPETR4_2000 <- PETR4.SA.Close[\"2000\"]\nchartSeries(PETR4_2000,theme=\"white\")\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-5-1.png){width=80%}\n:::\n:::\n\n\n## Podemos extrair um intervalo?\n\nVamos usar os dados de 2000 a 2001.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPETR4_2000_2001 <- PETR4.SA.Close[\"2000/2001\"] \nchartSeries(PETR4_2000_2001,theme=\"white\")\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-6-1.png){width=80%}\n:::\n:::\n\n\n## Vamos trabalhar com outro intervalo\n\nVamos usar dados de set/21 a set/22.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPETR4.SA.Close <- PETR4.SA.Close[\"2021-09-01/2022-09-30\"]\nchartSeries(PETR4.SA.Close,theme=\"white\")\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-7-1.png){width=80%}\n:::\n:::\n\n\n## Visualizando o início e o fim da serie\n\nAqui vamos usar funções da xts visualizar diferentes periodos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfirst(PETR4.SA.Close, \"month\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           PETR4.SA.Close\n2021-09-01          27.04\n2021-09-02          26.60\n2021-09-03          26.33\n2021-09-06          26.46\n2021-09-08          24.97\n2021-09-09          25.50\n2021-09-10          25.34\n2021-09-13          26.23\n2021-09-14          25.88\n2021-09-15          26.33\n2021-09-16          26.10\n2021-09-17          24.93\n2021-09-20          24.65\n2021-09-21          25.21\n2021-09-22          25.85\n2021-09-23          26.84\n2021-09-24          26.90\n2021-09-27          27.14\n2021-09-28          26.96\n2021-09-29          27.39\n2021-09-30          27.23\n```\n:::\n\n```{.r .cell-code}\nlast(PETR4.SA.Close, \"6 weeks\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           PETR4.SA.Close\n2022-08-22          32.41\n2022-08-23          33.44\n2022-08-24          33.64\n2022-08-25          33.28\n2022-08-26          33.64\n2022-08-29          34.48\n2022-08-30          32.43\n2022-08-31          33.23\n2022-09-01          33.85\n2022-09-02          33.42\n2022-09-05          33.34\n2022-09-06          32.10\n2022-09-08          31.80\n2022-09-09          31.79\n2022-09-12          31.48\n2022-09-13          30.65\n2022-09-14          31.12\n2022-09-15          31.06\n2022-09-16          30.78\n2022-09-19          31.27\n2022-09-20          31.09\n2022-09-21          31.17\n2022-09-22          31.94\n2022-09-23          29.94\n2022-09-26          29.29\n2022-09-27          29.67\n2022-09-28          29.27\n2022-09-29          29.31\n```\n:::\n:::\n\n\n## Vamos agora trabalhar com os log retornos das ações\n\nPara obter os log retornos vamos usar uma função da biblioteca qrmtools.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(qrmtools)\npetr4.logret <- returns(PETR4.SA.Close, method=\"logarithmic\")\nhead(petr4.logret)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                   [,1]\n2021-09-02 -0.016406055\n2021-09-03 -0.010202260\n2021-09-06  0.004925153\n2021-09-08 -0.057959047\n2021-09-09  0.021003375\n2021-09-10 -0.006294271\n```\n:::\n\n```{.r .cell-code}\nchartSeries(petr4.logret,theme=\"white\")\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-9-1.png){width=80%}\n:::\n:::\n\n\n## Podemos agragar valores diários de diversas formas\n\nPara agregar valores de series temporais vamos usar a biblioteca xts\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(xts)\npetr4.logret.sem <- apply.weekly(petr4.logret, sum)\nfirst(petr4.logret.sem, \"2 week\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                  [,1]\n2021-09-03 -0.02660831\n2021-09-10 -0.03832479\n```\n:::\n\n```{.r .cell-code}\npetr4.logret.men <- apply.monthly(petr4.logret, sum)\nfirst(petr4.logret.men, \"2 month\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                   [,1]\n2021-09-30  0.007002005\n2021-10-29 -0.002942258\n```\n:::\n:::\n\n\n## Os log retornos seguem uma distribuição normal?\n\nVamos usar alguma ferrametas gráficas para avaliar os dados de log-retorno\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmu <- mean(petr4.logret)\nsigma <- sd(petr4.logret)\nc(mu, sigma)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.0002996708 0.0264217205\n```\n:::\n\n```{.r .cell-code}\nx <- sort(coredata(petr4.logret))\nhist(x, breaks = \"Sturges\" , probability = TRUE)\nlines(x, dnorm(x, mean = mu, sd = sigma), col = \"red\")\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-11-1.png){width=80%}\n:::\n\n```{.r .cell-code}\nqqnorm(x)\nqqline(x)\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-11-2.png){width=80%}\n:::\n:::\n\n\n## Outra avaliação Jarque-Bera\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(moments)\nx <- sort(coredata(petr4.logret))\njarque.test(x)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tJarque-Bera Normality Test\n\ndata:  x\nJB = 367.04, p-value < 2.2e-16\nalternative hypothesis: greater\n```\n:::\n:::\n\n\n## E o log retorno semanal?\n\nVamos usar alguma ferrametas gráficas para avaliar os dados de log-retorno\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmu <- mean(petr4.logret.sem)\nsigma <- sd(petr4.logret.sem)\nc(mu, sigma)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.001414236 0.052515182\n```\n:::\n\n```{.r .cell-code}\nx <- sort(coredata(petr4.logret.sem))\nhist(x, breaks = \"Sturges\" , probability = TRUE)\nlines(x, dnorm(x, mean = mu, sd = sigma), col = \"red\")\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-13-1.png){width=80%}\n:::\n\n```{.r .cell-code}\nqqnorm(x)\nqqline(x)\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-13-2.png){width=80%}\n:::\n:::\n\n\n## Outra avaliação Jarque-Bera\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(moments)\nx <- sort(coredata(petr4.logret.sem))\njarque.test(x)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tJarque-Bera Normality Test\n\ndata:  x\nJB = 1.0108, p-value = 0.6033\nalternative hypothesis: greater\n```\n:::\n:::\n",
    "supporting": [
      "Aula04_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}