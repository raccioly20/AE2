{
  "hash": "05dcbbe2154781f22d0117ca51901b19",
  "result": {
    "markdown": "---\ntitle: \"Análise Exploratória de Series Temporais\"\nauthor: \"Ricardo Accioly\"\ndate: \"2023-06-07\"\nformat:\n html:\n    code-link: true\n---\n\n\n\n\n## Séries Temporais\n\nNestes exemplos vamos usar algumas bibliotecas do R que são usadas na análise de séries temporais.\n\n## Carregando uma série de um arquivo Excel\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)\nconsumo_resid <- read_xlsx(\"e:/Onedrive/github/ae2/semanas/consumo_residencial.xlsx\")\nsummary(consumo_resid)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      data                        mwh_residencial   \n Min.   :2004-01-01 00:00:00.00   Min.   : 6291091  \n 1st Qu.:2008-09-23 12:00:00.00   1st Qu.: 7954710  \n Median :2013-06-16 00:00:00.00   Median :10275550  \n Mean   :2013-06-16 08:25:15.78   Mean   : 9899939  \n 3rd Qu.:2018-03-08 18:00:00.00   3rd Qu.:11537543  \n Max.   :2022-12-01 00:00:00.00   Max.   :13924000  \n```\n:::\n:::\n\n\n## Transformando os dados para o formato tsibble\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tsibble)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'tsibble'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, union\n```\n:::\n\n```{.r .cell-code}\nconsumo_resid$data <- seq(as.Date(\"2004-01-01\"), as.Date(\"2022-12-01\"), by = \"1 month\")\ncons_resid <- tsibble(yearmonth(consumo_resid$data), value=consumo_resid$mwh_residencial)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nUsing `<mth>` as index variable.\n```\n:::\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\ncons_resid <- cons_resid %>% rename(ano_mes = `<mth>`, mwh = value)\n```\n:::\n\n\n## Visualizando uma série\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(fable)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nCarregando pacotes exigidos: fabletools\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\ncons_resid %>% autoplot(vars(mwh)) + xlab(\"Ano\") + ylab(\"\") +\n  ggtitle(\"Consumo Residencial Total no Brasil (MWh) - Fonte EPE\")\n```\n\n::: {.cell-output-display}\n![](Aula01_files/figure-html/unnamed-chunk-4-1.png){width=80%}\n:::\n:::\n\n\n## Transformando e Visualizando uma Serie\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncons_resid <- cons_resid %>% mutate(mwh_raiz = sqrt(mwh),\n                              mwh_rcub = (mwh)^0.33333,\n                              mwh_log = log(mwh),\n                              mwh_inv = (mwh)^-1)\n\ncons_resid %>% autoplot(vars(mwh_raiz)) + xlab(\"Ano\") + ylab(\"\") + ggtitle(\"Raiz do Consumo Residencial Total no Brasil (MWh) - Fonte EPE\")\n```\n\n::: {.cell-output-display}\n![](Aula01_files/figure-html/unnamed-chunk-5-1.png){width=80%}\n:::\n\n```{.r .cell-code}\ncons_resid %>% autoplot(vars(mwh_rcub)) + xlab(\"Ano\") + ylab(\"\") +   ggtitle(\"Raiz Cúbica do Consumo Residencial Total no Brasil (MWh) - Fonte EPE\")\n```\n\n::: {.cell-output-display}\n![](Aula01_files/figure-html/unnamed-chunk-5-2.png){width=80%}\n:::\n\n```{.r .cell-code}\ncons_resid %>% autoplot(vars(mwh_log)) + xlab(\"Ano\") + ylab(\"\") +   ggtitle(\"Log do Consumo Residencial Total no Brasil (MWh) - Fonte EPE\")\n```\n\n::: {.cell-output-display}\n![](Aula01_files/figure-html/unnamed-chunk-5-3.png){width=80%}\n:::\n\n```{.r .cell-code}\ncons_resid %>% autoplot(vars(mwh_inv)) + xlab(\"Ano\") + ylab(\"\") +   ggtitle(\"Inversa do Consumo Residencial Total no Brasil (MWh) - Fonte EPE\")\n```\n\n::: {.cell-output-display}\n![](Aula01_files/figure-html/unnamed-chunk-5-4.png){width=80%}\n:::\n:::\n\n\n## Obtendo e Visualizando uma ST econômica\n\nVamos inicialmente usando a biblioteca (pacote) quantmod fazer um download dos preços das ações da Apple (AAPL) entre 2000 e 2022.\n\nA biblioteca quantmod depende dos pacotes xts e do zoo que são dois pacotes usados para manipular dados de series temporais.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(quantmod)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nCarregando pacotes exigidos: xts\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCarregando pacotes exigidos: zoo\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'zoo'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:tsibble':\n\n    index\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    as.Date, as.Date.numeric\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\n######################### Warning from 'xts' package ##########################\n#                                                                             #\n# The dplyr lag() function breaks how base R's lag() function is supposed to  #\n# work, which breaks lag(my_xts). Calls to lag(my_xts) that you type or       #\n# source() into this session won't work correctly.                            #\n#                                                                             #\n# Use stats::lag() to make sure you're not using dplyr::lag(), or you can add #\n# conflictRules('dplyr', exclude = 'lag') to your .Rprofile to stop           #\n# dplyr from breaking base R's lag() function.                                #\n#                                                                             #\n# Code in packages is not affected. It's protected by R's namespace mechanism #\n# Set `options(xts.warn_dplyr_breaks_lag = FALSE)` to suppress this warning.  #\n#                                                                             #\n###############################################################################\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'xts'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:dplyr':\n\n    first, last\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCarregando pacotes exigidos: TTR\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nRegistered S3 method overwritten by 'quantmod':\n  method            from\n  as.zoo.data.frame zoo \n```\n:::\n\n```{.r .cell-code}\ngetSymbols(\"AAPL\",from=\"2020-01-02\", to=\"2022-12-31\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"AAPL\"\n```\n:::\n\n```{.r .cell-code}\ndim(AAPL) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 756   6\n```\n:::\n\n```{.r .cell-code}\nhead(AAPL)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           AAPL.Open AAPL.High AAPL.Low AAPL.Close AAPL.Volume AAPL.Adjusted\n2020-01-02   74.0600   75.1500  73.7975    75.0875   135480400      73.34794\n2020-01-03   74.2875   75.1450  74.1250    74.3575   146322800      72.63486\n2020-01-06   73.4475   74.9900  73.1875    74.9500   118387200      73.21360\n2020-01-07   74.9600   75.2250  74.3700    74.5975   108872000      72.86929\n2020-01-08   74.2900   76.1100  74.2900    75.7975   132079200      74.04148\n2020-01-09   76.8100   77.6075  76.5500    77.4075   170108400      75.61419\n```\n:::\n\n```{.r .cell-code}\ntail(AAPL)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           AAPL.Open AAPL.High AAPL.Low AAPL.Close AAPL.Volume AAPL.Adjusted\n2022-12-22    134.35    134.56   130.30     132.23    77852100      131.8460\n2022-12-23    130.92    132.42   129.64     131.86    63814900      131.4771\n2022-12-27    131.38    131.41   128.72     130.03    69007800      129.6524\n2022-12-28    129.67    131.03   125.87     126.04    85438400      125.6740\n2022-12-29    127.99    130.48   127.73     129.61    75703700      129.2337\n2022-12-30    128.41    129.95   127.43     129.93    77034200      129.5527\n```\n:::\n\n```{.r .cell-code}\n# A biblioteca tem uma forma diferenciada de apresentação das series financeiras\nchartSeries(AAPL,theme=\"white\")\n```\n\n::: {.cell-output-display}\n![](Aula01_files/figure-html/unnamed-chunk-6-1.png){width=80%}\n:::\n\n```{.r .cell-code}\nstr(AAPL)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAn xts object on 2020-01-02 / 2022-12-30 containing: \n  Data:    double [756, 6]\n  Columns: AAPL.Open, AAPL.High, AAPL.Low, AAPL.Close, AAPL.Volume ... with 1 more column\n  Index:   Date [756] (TZ: \"UTC\")\n  xts Attributes:\n    $ src    : chr \"yahoo\"\n    $ updated: POSIXct[1:1], format: \"2023-06-07 15:24:42\"\n```\n:::\n:::\n\n\nVeja que os dados recebidos tem valores de abertura (open), alta (high), baixa (low) e fechamento (close)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(AAPL)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     Index              AAPL.Open        AAPL.High         AAPL.Low     \n Min.   :2020-01-02   Min.   : 57.02   Min.   : 57.12   Min.   : 53.15  \n 1st Qu.:2020-09-30   1st Qu.:115.92   1st Qu.:117.28   1st Qu.:114.13  \n Median :2021-07-01   Median :135.79   Median :137.20   Median :133.75  \n Mean   :2021-07-01   Mean   :130.23   Mean   :131.89   Mean   :128.61  \n 3rd Qu.:2022-03-31   3rd Qu.:150.26   3rd Qu.:151.90   3rd Qu.:149.03  \n Max.   :2022-12-30   Max.   :182.63   Max.   :182.94   Max.   :179.12  \n   AAPL.Close      AAPL.Volume        AAPL.Adjusted   \n Min.   : 56.09   Min.   : 35195900   Min.   : 54.92  \n 1st Qu.:115.74   1st Qu.: 76364700   1st Qu.:113.84  \n Median :135.38   Median : 94935800   Median :134.34  \n Mean   :130.31   Mean   :112092019   Mean   :128.91  \n 3rd Qu.:150.71   3rd Qu.:129632700   3rd Qu.:149.71  \n Max.   :182.01   Max.   :426510000   Max.   :180.43  \n```\n:::\n:::\n\n\n## Vamos selecionar somente o fechamento (close)\n\nPara trabalhar com somente uma das series vamos selecionar sua coluna de dados\n\n\n::: {.cell}\n\n```{.r .cell-code}\nAAPL_C <- AAPL[,\"AAPL.Close\"]\nchartSeries(AAPL_C,theme=\"white\")\n```\n\n::: {.cell-output-display}\n![](Aula01_files/figure-html/unnamed-chunk-8-1.png){width=80%}\n:::\n:::\n",
    "supporting": [
      "Aula01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}